- Pattern Match  0- Pattern Match █████ 1- Pattern Match ██████████ 2- Pattern Match ████████████████ 3- Pattern Match █████████████████████ 4- Pattern Match ███████████████████████████ 5- Pattern Match ████████████████████████████████ 6- Pattern Match ██████████████████████████████████████ 7- Pattern Match ███████████████████████████████████████████ 8- Pattern Match █████████████████████████████████████████████████ 9- Pattern Match ██████████████████████████████████████████████████████ 10- Pattern Match ████████████████████████████████████████████████████████████ 11
- Semantic Grep  0- Semantic Grep  1- Semantic Grep  2- Semantic Grep  3- Semantic Grep  4- Semantic Grep  5- Semantic Grep  6- Semantic Grep  7- Semantic Grep  8- Semantic Grep  9- Semantic Grep  10- Semantic Grep  11- Semantic Grep  12- Semantic Grep  13- Semantic Grep  14- Semantic Grep  15- Semantic Grep  16
[34m
njsscan: v0.3.6 | Ajin Abraham | opensecurity.in[0m
[31m╒═════════════╤═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ RULE ID     │ node_sqli_injection                                                                                                                                                           │
├─────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ CWE         │ CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')                                                                                  │
├─────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ OWASP-WEB   │ A1: Injection                                                                                                                                                                 │
├─────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ DESCRIPTION │ Untrusted input concatinated with raw SQL query can result in SQL Injection.                                                                                                  │
├─────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ SEVERITY    │ ERROR                                                                                                                                                                         │
├─────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ FILES       │ ╒════════════════╤══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕ │
│             │ │ File           │ backend/persistence/db.js                                                                                                                                │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 153                                                                                                                                                  │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 13: 21                                                                                                                                                   │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const start = Date.now();                                                                                                                                │ │
│             │ │                │     const res = await database.query(text);                                                                                                              │ │
│             │ │                │     const duration = Date.now() - start;                                                                                                                 │ │
│             │ │                │     logger.info('executed query', {text, duration, rows: res.rowCount});                                                                                 │ │
│             │ │                │     // add to the logs table                                                                                                                             │ │
│             │ │                │     // we are adding a query as varchar so we need to escape it                                                                                          │ │
│             │ │                │     // otherwise we will an sql injection INSIDE our logs table as well ;)                                                                               │ │
│             │ │                │     text = text.replace(/'/g, "''");                                                                                                                     │ │
│             │ │                │     database.query(`INSERT INTO logs (username, query, timestamp, duration) VALUES ('${user}', '${text}', '${new Date().toISOString()}', ${duration})`); │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/persistence/db.js                                                                                                                                │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 153                                                                                                                                                  │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 15: 21                                                                                                                                                   │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const duration = Date.now() - start;                                                                                                                     │ │
│             │ │                │     logger.info('executed query', {text, duration, rows: res.rowCount});                                                                                 │ │
│             │ │                │     // add to the logs table                                                                                                                             │ │
│             │ │                │     // we are adding a query as varchar so we need to escape it                                                                                          │ │
│             │ │                │     // otherwise we will an sql injection INSIDE our logs table as well ;)                                                                               │ │
│             │ │                │     text = text.replace(/'/g, "''");                                                                                                                     │ │
│             │ │                │     database.query(`INSERT INTO logs (username, query, timestamp, duration) VALUES ('${user}', '${text}', '${new Date().toISOString()}', ${duration})`); │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/persistence/db.js                                                                                                                                │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 153                                                                                                                                                  │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 20: 21                                                                                                                                                   │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ text = text.replace(/'/g, "''");                                                                                                                         │ │
│             │ │                │     database.query(`INSERT INTO logs (username, query, timestamp, duration) VALUES ('${user}', '${text}', '${new Date().toISOString()}', ${duration})`); │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/persistence/db.js                                                                                                                                │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 152                                                                                                                                                  │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 21                                                                                                                                                       │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ database.query(`INSERT INTO logs (username, query, timestamp, duration) VALUES ('${user}', '${text}', '${new Date().toISOString()}', ${duration})`);     │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/persistence/db.js                                                                                                                                │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 33                                                                                                                                                   │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 27: 28                                                                                                                                                   │ │
│             │ ├────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ query = await readFile(initSqlPath);                                                                                                                     │ │
│             │ │                │     await database.query(query);                                                                                                                         │ │
│             │ ╘════════════════╧══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛ │
╘═════════════╧═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛[0m
[31m╒═════════════╤═════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ RULE ID     │ express_xss                                                                                                                                                                                                         │
├─────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ CWE         │ CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')                                                                                                                        │
├─────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ OWASP-WEB   │ A1: Injection                                                                                                                                                                                                       │
├─────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ DESCRIPTION │ Untrusted User Input in Response will result in Reflected Cross Site Scripting Vulnerability.                                                                                                                       │
├─────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ SEVERITY    │ ERROR                                                                                                                                                                                                               │
├─────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ FILES       │ ╒════════════════╤════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╕ │
│             │ │ File           │ backend/routes/transactions.js                                                                                                                                                                 │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 6                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 26: 42                                                                                                                                                                                         │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const transactionId = req.params.id;                                                                                                                                                           │ │
│             │ │                │     try {                                                                                                                                                                                      │ │
│             │ │                │         const result = await db.query(`SELECT * FROM transactions WHERE transaction_id = ${transactionId}`);                                                                                   │ │
│             │ │                │         // check if the from_user_id is the same as the user_id in the session                                                                                                                 │ │
│             │ │                │         if (                                                                                                                                                                                   │ │
│             │ │                │             (result.rows[0].from_user_id != req.session.user.id)                                                                                                                               │ │
│             │ │                │             &&                                                                                                                                                                                 │ │
│             │ │                │             (req.session.user.role != 'Admin')                                                                                                                                                 │ │
│             │ │                │             ) throw Error('Not authorized');                                                                                                                                                   │ │
│             │ │                │         if (result.rows.length == 0) throw Error('Transaction not found');                                                                                                                     │ │
│             │ │                │         res.send(result.rows);                                                                                                                                                                 │ │
│             │ │                │     } catch (err) {                                                                                                                                                                            │ │
│             │ │                │         res.status(400).send({                                                                                                                                                                 │ │
│             │ │                │             message: err.message,                                                                                                                                                              │ │
│             │ │                │             status : 'error'                                                                                                                                                                   │ │
│             │ │                │         });                                                                                                                                                                                    │ │
│             │ │                │     }                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/routes/transactions.js                                                                                                                                                                 │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 6                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 92: 102                                                                                                                                                                                        │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const transactionId = req.params.id;                                                                                                                                                           │ │
│             │ │                │     const {user_id, amount, description} = req.body;                                                                                                                                           │ │
│             │ │                │     try {                                                                                                                                                                                      │ │
│             │ │                │         const result = await db.query(`UPDATE transactions SET user_id = ${user_id}, amount = ${amount}, description = '${description}' WHERE transaction_id = ${transactionId} RETURNING *`); │ │
│             │ │                │         res.send(result.rows[0]);                                                                                                                                                              │ │
│             │ │                │     } catch (err) {                                                                                                                                                                            │ │
│             │ │                │         res.status(400).send({                                                                                                                                                                 │ │
│             │ │                │             message: err.message,                                                                                                                                                              │ │
│             │ │                │             status : 'error'                                                                                                                                                                   │ │
│             │ │                │         });                                                                                                                                                                                    │ │
│             │ │                │     }                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/routes/transactions.js                                                                                                                                                                 │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 6                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 107: 116                                                                                                                                                                                       │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const transactionId = req.params.id;                                                                                                                                                           │ │
│             │ │                │     try {                                                                                                                                                                                      │ │
│             │ │                │         const result = await db.query(`DELETE FROM transactions WHERE transaction_id = ${transactionId} RETURNING *`);                                                                         │ │
│             │ │                │         res.send(result.rows[0]);                                                                                                                                                              │ │
│             │ │                │     } catch (err) {                                                                                                                                                                            │ │
│             │ │                │         res.status(400).send({                                                                                                                                                                 │ │
│             │ │                │             message: err.message,                                                                                                                                                              │ │
│             │ │                │             status : 'error'                                                                                                                                                                   │ │
│             │ │                │         });                                                                                                                                                                                    │ │
│             │ │                │     }                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/routes/users.js                                                                                                                                                                        │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 6                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 22: 29                                                                                                                                                                                         │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const userId = req.params.id;                                                                                                                                                                  │ │
│             │ │                │     try {                                                                                                                                                                                      │ │
│             │ │                │         const result = await db.query(`SELECT * FROM users WHERE user_id = ${userId}`);                                                                                                        │ │
│             │ │                │         if (result.rows.length == 0) throw Error('User not found');                                                                                                                            │ │
│             │ │                │         res.send(result.rows);                                                                                                                                                                 │ │
│             │ │                │     } catch (err) {                                                                                                                                                                            │ │
│             │ │                │         res.status(400).send(err.message);                                                                                                                                                     │ │
│             │ │                │     }                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/routes/users.js                                                                                                                                                                        │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 6                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 45: 52                                                                                                                                                                                         │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const userId = req.params.id;                                                                                                                                                                  │ │
│             │ │                │     const {username, password, is_admin} = req.body;                                                                                                                                           │ │
│             │ │                │     try {                                                                                                                                                                                      │ │
│             │ │                │         const result = await db.query(`UPDATE users SET username = '${username}', password = '${password}', is_admin = ${is_admin} WHERE user_id = ${userId} RETURNING *`);                    │ │
│             │ │                │         res.send(result.rows[0]);                                                                                                                                                              │ │
│             │ │                │     } catch (err) {                                                                                                                                                                            │ │
│             │ │                │         res.status(400).send(err.message);                                                                                                                                                     │ │
│             │ │                │     }                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ File           │ backend/routes/users.js                                                                                                                                                                        │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match Position │ 5 - 6                                                                                                                                                                                          │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Line Number(s) │ 57: 63                                                                                                                                                                                         │ │
│             │ ├────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│             │ │ Match String   │ const userId = req.params.id;                                                                                                                                                                  │ │
│             │ │                │     try {                                                                                                                                                                                      │ │
│             │ │                │         const result = await db.query(`DELETE FROM users WHERE user_id = ${userId} RETURNING *`);                                                                                              │ │
│             │ │                │         res.send(result.rows[0]);                                                                                                                                                              │ │
│             │ │                │     } catch (err) {                                                                                                                                                                            │ │
│             │ │                │         res.status(400).send(err.message);                                                                                                                                                     │ │
│             │ │                │     }                                                                                                                                                                                          │ │
│             │ ╘════════════════╧════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛ │
╘═════════════╧═════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╛[0m
